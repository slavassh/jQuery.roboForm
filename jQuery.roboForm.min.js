/**
 * Application:  jQuery.roboForm
 * Version:      1.1.6
 * Release date: 2016-10-16
 * Author:       Stepan Maslennikov (http://csscode.ru)
 * Homepage:     https://github.com/StepanMas/jQuery.roboForm
 * License:      MIT
*/

!function(a){"use strict";a.roboForm=function(b){var c={formCls:".roboForm",field:":input[data-roborules]:visible",errorElement:".roboForm_error",errorVisible:".roboForm_show",lang:"en",i18n:{ru:{mess_noRequired:"Заполните поле",mess_noRequiredCheck:"Отметьте поле",mess_noEmail:"Укажите почту правильно",mess_noPhone:"Укажите номер правильно",mess_noPattern:"Заполните поле правильно",mess_noInteger:"Можно вводить только целое число",mess_noFloat:"Можно вводить только целое число или число с плавающей точкой",mess_noCyrillic:"Допускаются только символы кириллицы, цифры и символы -_.,?!",mess_range:"Укажите $1 цифр"},en:{mess_noRequired:"Fill in the field",mess_noRequiredCheck:"Check the box",mess_noEmail:"E-mail is incorrect",mess_noPhone:"Number is incorrect",mess_noPattern:"Fill in the field",mess_noInteger:"You can only enter an integer",mess_noFloat:"You can enter only integer or floating point number",mess_noCyrillic:"Allowed only Latin symbols, numbers, and symbols -_.,?!",mess_range:"Only $1 digits"}},isNotification:!0,isNotificationAjaxError:!1,isMyNoty:a.isFunction(a.miniNoty)},d=a(document);c.errorElementClass=c.errorElement.replace(".",""),c.errorVisibleClass=c.errorVisible.replace(".",""),b=a.extend(c,b),d.on("submit",b.formCls,function(){var c=a(this),d=!0;return a(b.field,this).each(function(){var c,g=a(this),h=g.next(),i=a.trim(g.val()),j=g.data("roborules");if(g.removeClass(b.errorElementClass),h.length&&h.hasClass(b.errorVisibleClass)&&h.removeClass(b.errorVisibleClass),f("required",j)&&""===i&&(d=e(g,b.i18n[b.lang].mess_noRequired)),g.is(":checkbox, :radio")&&f("required",j)&&!g.is(":checked")&&(d=e(g,b.i18n[b.lang].mess_noRequiredCheck)),f("email",j)&&(f("required",j)||""!==i)&&(c=/^([a-z0-9_\-]+\.)*[a-z0-9_\-]+@([a-z0-9][a-z0-9\-]*[a-z0-9]\.)+[a-z]{2,4}$/i,c.test(i)||(d=e(g,b.i18n[b.lang].mess_noEmail))),f("phone",j)&&(f("required",j)||""!==i)&&(/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/.test(i)||(d=e(g,b.i18n[b.lang].mess_noPhone))),f("integer",j)&&(f("required",j)||""!==i)&&(/^\d+$/.test(i)||(d=e(g,b.i18n[b.lang].mess_noInteger))),f("float",j)&&(f("required",j)||""!==i)&&(/^(\d|\.)+$/.test(i)||(d=e(g,b.i18n[b.lang].mess_noFloat))),f("cyrillic",j)&&(f("required",j)||""!==i)&&(/^[а-яё\d\s-_.,\?!]+$/i.test(i)||(d=e(g,b.i18n[b.lang].mess_noCyrillic))),f("range",j)&&(f("required",j)||""!==i)){var k=g.data("range").toString();if(k.indexOf("-")!==-1)k=k.split("-"),(i.length<parseInt(k[0])||i.length>parseInt(k[1]))&&(d=e(g,b.i18n[b.lang].mess_range.replace("$1",g.data("range"))));else if(k.indexOf("|")!==-1){k=k.split("|");var l=!1;a.each(k,function(a,b){if(b===i.length)return l=!0,!1}),l||(d=e(g,b.i18n[b.lang].mess_range.replace("$1",g.data("range"))))}else i.length!==parseInt(k)&&(d=e(g,b.i18n[b.lang].mess_range.replace("$1",g.data("range"))))}f("pattern",j)&&(f("required",j)||""!==i)&&(c=new RegExp(g.data("robopattern")),c.test(i)||(d=e(g,b.i18n[b.lang].mess_noPattern)))}),d?(d=a._roboFormRules(c,b),d&&c.trigger({type:"roboForm.valid.true"}),d&&a(this).data("ajax")&&!a(this).prop("disabled")&&!a(this).hasClass("disabled")?(a.ajax({type:a(this).attr("method")||"POST",data:a(this).serialize(),url:a(this).attr("action"),success:function(d){try{d=a.parseJSON(d)}catch(a){throw new Error(a)}if(b.isNotification)try{d.success?b.isMyNoty?a.miniNoty(d.success,"success"):alert(d.success):d.error&&(b.isMyNoty?a.miniNoty(d.error,"error"):alert(d.error))}catch(a){console.error(a,"jQuery.roboForm expects an JSON array")}c.trigger({type:"roboForm.ajax.success",response:d})},error:function(c){if(b.isNotificationAjaxError){var d=c.status+": "+c.statusText;b.isMyNoty?a.miniNoty(d,"error"):alert(d)}}}),!1):d):(c.trigger({type:"roboForm.valid.false"}),!1)}),d.on("click",b.errorElement,function(){a(this).removeClass(c.errorVisibleClass).prev().removeClass(c.errorElementClass)}),d.on("focus",b.field,function(){a(this).removeClass(c.errorElementClass).next().removeClass(c.errorVisibleClass)});var e=function(c,d){a('input[type="submit"], .createEvent[data-event="submit"]').removeClass("loader"),c.data("robomessage")&&(d=c.data("robomessage")),c.addClass(b.errorElementClass),console.error(d,c);var e=c.next();return e.length&&e.hasClass(b.errorElementClass)?e.html(d):(e=document.createElement("div"),e.setAttribute("class",b.errorElementClass),e.innerHTML=d,c.after(e)),b.isValid=!1,a(e).addClass(b.errorVisibleClass),!1},f=function(a,b){return void 0!==b&&b.indexOf(a)!==-1}},a._roboFormRules=function(){return!0},a.roboFormAddRule=function(b){return a._roboFormRules=b,this}}(jQuery);